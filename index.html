<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Uhrzeit â€“ Sprechen (Alltagssprache)</title>
  <style>
    :root{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f3f4f6;}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;}
    .app{background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.1);padding:1.6rem 1.4rem;max-width:660px;width:100%;box-sizing:border-box;}
    h1{margin:0 0 .4rem;text-align:center;font-size:1.6rem;}
    .subtitle{text-align:center;color:#4b5563;margin-bottom:1rem;font-size:.95rem;line-height:1.35;}
    .hidden{display:none;}
    .center{text-align:center;}
    .choice-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.6rem;margin:.7rem 0 .4rem;}
    .choice-btn{padding:.9rem .6rem;border-radius:16px;border:2px solid #d1d5db;background:#f9fafb;font-size:1rem;font-weight:650;cursor:pointer;}
    .choice-btn.selected{background:#2563eb;color:#fff;border-color:#1d4ed8;box-shadow:0 5px 15px rgba(37,99,235,.35);}
    .selected-info{font-size:.85rem;color:#6b7280;text-align:center;min-height:1.2rem;margin:.2rem 0 .3rem;}
    .primary-btn{margin-top:.8rem;width:100%;padding:.75rem 1rem;font-size:1.1rem;border:none;border-radius:999px;cursor:pointer;background:#2563eb;color:#fff;font-weight:800;}
    .secondary-btn{margin-top:.4rem;width:100%;padding:.65rem 1rem;font-size:1rem;border-radius:999px;border:1px solid #d1d5db;cursor:pointer;background:#f9fafb;color:#111827;font-weight:700;}
    .progress{text-align:center;color:#6b7280;font-size:.9rem;margin-bottom:.4rem;}
    .tag{display:inline-block;border-radius:999px;padding:.15rem .6rem;font-size:.8rem;background:#eff6ff;color:#1d4ed8;}
    .clock-wrapper{display:flex;justify-content:center;margin-top:.6rem;}
    #clock-canvas{background:#f9fafb;border-radius:50%;box-shadow:inset 0 0 5px rgba(0,0,0,.08);}
    .answer-box{margin-top:1rem;border:1px solid #e5e7eb;background:#f9fafb;border-radius:14px;padding:.9rem;}
    .equation{text-align:center;margin:.4rem 0 .2rem;font-size:1.05rem;color:#111827;font-weight:900;}
    .mic-btn{width:100%;padding:.75rem 1rem;font-size:1.05rem;border-radius:999px;border:none;cursor:pointer;font-weight:900;background:#111827;color:#fff;}
    .mic-btn.listening{background:#dc2626;}
    .heard{margin-top:.6rem;font-size:.98rem;color:#111827;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.7rem .8rem;min-height:2.2rem;}
    .feedback{min-height:1.4rem;margin-top:.6rem;font-weight:900;text-align:center;}
    .feedback.ok{color:#15803d;}
    .feedback.error{color:#b91c1c;}
  </style>
</head>
<body>
<div class="app">
  <h1>Wie spÃ¤t ist es?</h1>

  <div id="quiz-screen">
    <div class="clock-wrapper">
      <canvas id="clock-canvas" width="240" height="240"></canvas>
    </div>

    <button class="mic-btn" id="mic-btn">ðŸŽ¤ Sprechen</button>

    <div class="heard" id="heard-raw"><strong>Rohtext:</strong> â€”</div>
    <div class="heard" id="heard-col"><strong>Alltagssprache:</strong> â€”</div>

    <div class="feedback" id="feedback"></div>
  </div>
</div>

<script>
/* ===== EINZIGE RELEVANTE FUNKTION ===== */

function normalizeToColloquialText(raw){
  if(!raw) return "";
  let t = raw.replace(/\s+/g," ").trim();

  // Zahlzeit HH:MM â†’ Alltagssprache
  t = t.replace(/\b(\d{1,2})[:.](\d{2})\b/g, (m, hh, mm) => {
    let H = parseInt(hh,10);
    let M = parseInt(mm,10);
    if(H===0) H=12;
    H = ((H-1)%12)+1;

    const map = {
      0:"punkt",5:"fÃ¼nf nach",10:"zehn nach",15:"viertel nach",20:"zwanzig nach",
      25:"fÃ¼nf vor halb",30:"halb",35:"fÃ¼nf nach halb",40:"zwanzig vor",
      45:"viertel vor",50:"zehn vor",55:"fÃ¼nf vor"
    };
    if(!(M in map)) return m;
    const hWord = ["eins","zwei","drei","vier","fÃ¼nf","sechs","sieben","acht","neun","zehn","elf","zwÃ¶lf"];
    const hour = (M>=25) ? hWord[H%12] : hWord[H-1];
    return `${map[M]} ${hour}`;
  });

  /* ===== FIX: 20 â†’ zwanzig ===== */
  const numMap = {
    "0":"zwÃ¶lf",
    "1":"eins","2":"zwei","3":"drei","4":"vier","5":"fÃ¼nf","6":"sechs",
    "7":"sieben","8":"acht","9":"neun","10":"zehn","11":"elf","12":"zwÃ¶lf",
    "15":"fÃ¼nfzehn",
    "20":"zwanzig"
  };
  t = t.replace(/\b(20|15|1[0-2]|[0-9])\b/g, m => numMap[m] ?? m);

  return t.toLowerCase().replace(/\s+/g," ").trim();
}

/* ===== DEMO ===== */
const micBtn = document.getElementById("mic-btn");
const rawEl = document.getElementById("heard-raw");
const colEl = document.getElementById("heard-col");

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
let rec = SR ? new SR() : null;

if(rec){
  rec.lang="de-DE";
  rec.onresult = e=>{
    const raw = e.results[0][0].transcript;
    rawEl.innerHTML="<strong>Rohtext:</strong> "+raw;
    colEl.innerHTML="<strong>Alltagssprache:</strong> "+normalizeToColloquialText(raw);
  };
}

micBtn.onclick=()=>{ if(rec) rec.start(); };
</script>
</body>
</html>
