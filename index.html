<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Uhrzeit ‚Äì Umgangssprache (Dropdown) 2./3. Klasse</title>
  <style>
    :root{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#f3f4f6;
    }
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;}
    .app{
      background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.10);
      padding:1.4rem 1.2rem;max-width:680px;width:100%;box-sizing:border-box;
    }
    h1{margin:0 0 .35rem;text-align:center;font-size:1.45rem;}
    .subtitle{margin:0 0 1rem;text-align:center;color:#4b5563;font-size:.95rem;line-height:1.35;}
    .row{display:flex;gap:.7rem;flex-wrap:wrap;align-items:center;justify-content:center}
    .choice-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.55rem;margin:.7rem 0;}
    .choice-btn{
      padding:.85rem .6rem;border-radius:14px;border:2px solid #d1d5db;background:#f9fafb;
      font-size:1rem;font-weight:700;cursor:pointer;transition:.15s;
    }
    .choice-btn.selected{background:#2563eb;color:#fff;border-color:#1d4ed8;box-shadow:0 5px 15px rgba(37,99,235,.35);}
    .primary-btn{
      width:100%;margin-top:.8rem;padding:.75rem 1rem;border-radius:999px;border:none;
      background:#2563eb;color:#fff;font-weight:800;font-size:1.05rem;cursor:pointer;
    }
    .primary-btn:disabled{background:#9ca3af;cursor:not-allowed;}
    .secondary-btn{
      width:100%;margin-top:.45rem;padding:.65rem 1rem;border-radius:999px;border:1px solid #d1d5db;
      background:#f9fafb;color:#111827;font-weight:700;font-size:1rem;cursor:pointer;
    }
    .selected-info{min-height:1.2rem;text-align:center;color:#6b7280;font-size:.88rem;margin-top:.25rem}
    .hidden{display:none;}
    .progress{font-size:.92rem;color:#6b7280;text-align:center;margin:.2rem 0 .6rem;}
    .tag{display:inline-block;border-radius:999px;padding:.12rem .65rem;font-size:.82rem;background:#eff6ff;color:#1d4ed8;font-weight:700}
    .clock-wrap{display:flex;justify-content:center;margin:.55rem 0 .35rem;}
    #clock{background:#f9fafb;border-radius:50%;box-shadow:inset 0 0 5px rgba(0,0,0,.08);max-width:240px;width:240px;height:240px}
    .dropdowns{
      display:grid;grid-template-columns:1fr 1fr 1fr;gap:.5rem;align-items:end;margin:.8rem 0 .3rem;
    }
    label{font-size:.85rem;color:#6b7280;font-weight:700}
    select{
      width:100%;padding:.65rem .6rem;border-radius:12px;border:2px solid #d1d5db;background:#fff;
      font-size:1.05rem;font-weight:800;letter-spacing:.02em;
    }
    .answer-line{
      display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;align-items:center;margin-top:.6rem;
      font-size:1.02rem;color:#374151;
    }
    .feedback{min-height:1.4rem;text-align:center;font-weight:800;margin-top:.55rem}
    .ok{color:#15803d;}
    .bad{color:#b91c1c;}
    .stats{margin-top:.7rem;font-size:.95rem;color:#374151;line-height:1.35}
    @media (max-width:560px){
      .dropdowns{grid-template-columns:1fr;gap:.65rem}
      #clock{width:210px;height:210px}
    }
  </style>
</head>
<body>
<div class="app">
  <h1>Uhrzeit ‚Äì Umgangssprache</h1>
  <p class="subtitle">
    Schau die Uhr an und w√§hle die passende umgangssprachliche Zeit.<br>
    Beispiel: <strong>f√ºnf</strong> <strong>vor halb</strong> <strong>neun</strong>
  </p>

  <!-- START -->
  <div id="start">
    <div class="row" style="margin-top:.2rem;">
      <div style="font-size:.92rem;color:#6b7280;font-weight:800;">Klasse</div>
    </div>
    <div class="choice-grid" id="gradeGrid">
      <button class="choice-btn grade" data-grade="2">2. klasse</button>
      <button class="choice-btn grade" data-grade="3">3. klasse</button>
    </div>

    <div class="row" style="margin-top:.2rem;">
      <div style="font-size:.92rem;color:#6b7280;font-weight:800;">stimme (tts)</div>
    </div>
    <div class="row" style="margin-top:.35rem;">
      <select id="voiceSelect" aria-label="stimme w√§hlen"></select>
    </div>

    <div class="selected-info" id="startInfo">bitte klasse ausw√§hlen.</div>
    <button class="primary-btn" id="startBtn" disabled>los!</button>
  </div>

  <!-- QUIZ -->
  <div id="quiz" class="hidden">
    <div class="progress" id="progress"></div>
    <div class="row"><span class="tag" id="variantTag"></span></div>

    <div class="clock-wrap"><canvas id="clock" width="240" height="240"></canvas></div>

    <div class="dropdowns">
      <div>
        <label for="p1">minuten</label>
        <select id="p1"></select>
      </div>
      <div>
        <label for="p2">form</label>
        <select id="p2"></select>
      </div>
      <div>
        <label for="p3">stunde</label>
        <select id="p3"></select>
      </div>
    </div>

    <div class="answer-line">
      <button class="secondary-btn" id="speakBtn" style="max-width:320px;">üîä zeit nochmals h√∂ren</button>
      <button class="primary-btn" id="checkBtn" style="max-width:320px;">pr√ºfen</button>
    </div>

    <div class="feedback" id="feedback"></div>

    <div class="stats">
      richtig: <span id="statOk">0</span> / <span id="statTotal">20</span><br>
      fehler: <span id="statBad">0</span>
    </div>
  </div>

  <!-- RESULT -->
  <div id="result" class="hidden" style="text-align:center;">
    <h2 style="margin:.2rem 0 .35rem;">fertig! üéâ</h2>
    <p id="summary" style="margin:.25rem 0 .8rem;color:#374151;"></p>
    <p style="margin-top:0.3rem; font-size:0.9rem; color:#4b5563;line-height:1.35;">
      wenn du mit deinem resultat zufrieden bist,<br>
      klicke <strong>‚Äûfertig‚Äú</strong>, damit learningview den auftrag als erledigt markiert.
    </p>
    <button class="primary-btn" id="finishBtn">fertig</button>
    <button class="secondary-btn" id="againBtn">weiter √ºben</button>
  </div>
</div>

<script>
  // -----------------------------
  // Einstellungen
  // -----------------------------
  const TOTAL = 20;

  // 2. Klasse: volle/halbe/viertel + 5-min Schritte? -> du wolltest: "volle 5 minuten-schritte"
  // Ich interpretiere:
  // - 2. Klasse: Minuten nur in 5er-Schritten (0,5,10,...,55) + die umgangssprachlichen Formen, die dazu passen
  // - 3. Klasse: ebenso, aber mehr "vor/nach" und "vor halb/nach halb" (immer 5er-Schritte)
  // Wichtig: Bewertung muss "halb drei" korrekt erkennen (= 2:30) und nicht falsch werten.
  //
  // Zus√§tzlich: ALLE Dropdown-W√∂rter klein.

  const HOUR_WORDS = ["eins","zwei","drei","vier","f√ºnf","sechs","sieben","acht","neun","zehn","elf","zw√∂lf"];

  const MIN_WORDS = ["", "f√ºnf","zehn","viertel","zwanzig"]; // "" nur f√ºr "punkt" oder "halb"
  const FORM_WORDS = ["punkt","nach","vor","halb","vor halb","nach halb"];

  // -----------------------------
  // State
  // -----------------------------
  let grade = null; // "2" | "3"
  let correct = 0, wrong = 0, done = 0;
  let used = new Set();
  let current = null; // {h, m}
  let selectedVoice = null;
  let voices = [];

  // -----------------------------
  // DOM
  // -----------------------------
  const startEl = document.getElementById("start");
  const quizEl = document.getElementById("quiz");
  const resultEl = document.getElementById("result");

  const gradeGrid = document.getElementById("gradeGrid");
  const startInfo = document.getElementById("startInfo");
  const startBtn = document.getElementById("startBtn");

  const voiceSelect = document.getElementById("voiceSelect");

  const progressEl = document.getElementById("progress");
  const variantTag = document.getElementById("variantTag");
  const canvas = document.getElementById("clock");
  const ctx = canvas.getContext("2d");

  const p1Sel = document.getElementById("p1");
  const p2Sel = document.getElementById("p2");
  const p3Sel = document.getElementById("p3");

  const speakBtn = document.getElementById("speakBtn");
  const checkBtn = document.getElementById("checkBtn");
  const feedbackEl = document.getElementById("feedback");

  const statOk = document.getElementById("statOk");
  const statBad = document.getElementById("statBad");
  const statTotal = document.getElementById("statTotal");

  const summaryEl = document.getElementById("summary");
  const finishBtn = document.getElementById("finishBtn");
  const againBtn = document.getElementById("againBtn");

  // -----------------------------
  // UI Helpers
  // -----------------------------
  function setFeedback(text, ok){
    feedbackEl.textContent = text;
    feedbackEl.className = "feedback " + (ok ? "ok" : "bad");
  }
  function clearFeedback(){
    feedbackEl.textContent = "";
    feedbackEl.className = "feedback";
  }

  // -----------------------------
  // Voice / TTS
  // -----------------------------
  function loadVoices(){
    if (!("speechSynthesis" in window)) {
      voiceSelect.innerHTML = `<option value="">tts nicht verf√ºgbar</option>`;
      voiceSelect.disabled = true;
      return;
    }
    voices = window.speechSynthesis.getVoices() || [];
    // bevorzugt: deutsch, weiblich ist im Browser nicht zuverl√§ssig erkennbar -> wir w√§hlen "de" und dann erste passende
    const deVoices = voices.filter(v => (v.lang || "").toLowerCase().startsWith("de"));
    const list = deVoices.length ? deVoices : voices;

    voiceSelect.innerHTML = "";
    list.forEach((v, idx) => {
      const opt = document.createElement("option");
      opt.value = String(idx);
      opt.textContent = `${v.name} (${v.lang})`;
      voiceSelect.appendChild(opt);
    });

    selectedVoice = list[0] || null;
  }

  function getSelectedVoice(){
    if (!("speechSynthesis" in window)) return null;
    const all = (window.speechSynthesis.getVoices() || []);
    const de = all.filter(v => (v.lang || "").toLowerCase().startsWith("de"));
    const list = de.length ? de : all;
    const idx = Number(voiceSelect.value || 0);
    return list[idx] || list[0] || null;
  }

  function speak(text){
    if (!("speechSynthesis" in window)) return;
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      const v = getSelectedVoice();
      if (v) u.voice = v;
      u.lang = v?.lang || "de-CH";
      u.rate = 0.92;
      window.speechSynthesis.speak(u);
    }catch(e){
      console.warn("tts fehler:", e);
    }
  }

  voiceSelect.addEventListener("change", () => {
    selectedVoice = getSelectedVoice();
  });

  // voices laden (Browser teils async)
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = loadVoices;
  }
  loadVoices();

  // -----------------------------
  // Clock
  // -----------------------------
  function drawClock(hour, minute){
    const w = canvas.width, h = canvas.height;
    const r = Math.min(w,h)/2 - 10;
    const cx = w/2, cy = h/2;

    ctx.clearRect(0,0,w,h);
    ctx.save();
    ctx.translate(cx, cy);

    // face
    ctx.beginPath();
    ctx.arc(0,0,r,0,Math.PI*2);
    ctx.fillStyle="#ffffff";
    ctx.fill();
    ctx.lineWidth=3;
    ctx.strokeStyle="#111827";
    ctx.stroke();

    // ticks
    for(let i=0;i<60;i++){
      const a = (Math.PI/30)*i - Math.PI/2;
      const isHour = (i%5===0);
      const inner = r - (isHour ? 18 : 10);
      const outer = r - 4;
      ctx.beginPath();
      ctx.moveTo(inner*Math.cos(a), inner*Math.sin(a));
      ctx.lineTo(outer*Math.cos(a), outer*Math.sin(a));
      ctx.lineWidth = isHour ? 3 : 1.4;
      ctx.strokeStyle="#111827";
      ctx.stroke();
    }

    // center
    ctx.beginPath();
    ctx.arc(0,0,4,0,Math.PI*2);
    ctx.fillStyle="#111827";
    ctx.fill();

    // minute hand (blue)
    const ma = (Math.PI/30)*minute - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo((r-24)*Math.cos(ma),(r-24)*Math.sin(ma));
    ctx.lineWidth=5;
    ctx.lineCap="round";
    ctx.strokeStyle="#2563eb";
    ctx.stroke();

    // hour hand (red)
    const h12 = hour % 12;
    const ha = (Math.PI/6)*(h12 + minute/60) - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo((r-52)*Math.cos(ha),(r-52)*Math.sin(ha));
    ctx.lineWidth=7;
    ctx.lineCap="round";
    ctx.strokeStyle="#ef4444";
    ctx.stroke();

    ctx.restore();
  }

  // -----------------------------
  // Time ‚Üî dropdown logic (FIXED)
  // -----------------------------
  function hourNumToWord(h){ // 1..12
    return HOUR_WORDS[(h-1) % 12];
  }
  function wordToHourNum(word){
    const idx = HOUR_WORDS.indexOf(word);
    return idx >= 0 ? idx+1 : null;
  }
  function nextHourNum(h){
    return (h % 12) + 1;
  }

  // Generates the *canonical* colloquial phrase parts for a time (h:1..12, m:0..55 step 5)
  // Returns {p1, p2, p3, spokenText}
  // Important: "halb drei" means 2:30, so p3 = next hour word.
  function timeToParts(h, m){
    const hh = ((h-1)%12)+1;
    const next = nextHourNum(hh);

    // We only use 5-min increments
    const p = {p1:"", p2:"", p3:"", spokenText:""};

    if (m === 0){
      p.p1 = "";
      p.p2 = "punkt";
      p.p3 = hourNumToWord(hh);
      p.spokenText = `punkt ${p.p3} uhr`;
      return p;
    }

    if (m === 30){
      p.p1 = "";
      p.p2 = "halb";
      p.p3 = hourNumToWord(next);         // halb -> NEXT hour
      p.spokenText = `halb ${p.p3}`;
      return p;
    }

    // 5..20 after
    if (m === 5 || m === 10 || m === 15 || m === 20){
      p.p1 = (m===5?"f√ºnf":m===10?"zehn":m===15?"viertel":"zwanzig");
      p.p2 = "nach";
      p.p3 = hourNumToWord(hh);
      p.spokenText = `${p.p1} nach ${p.p3}`;
      return p;
    }

    // 25 -> five before half next
    if (m === 25){
      p.p1 = "f√ºnf";
      p.p2 = "vor halb";
      p.p3 = hourNumToWord(next);         // vor halb -> NEXT hour
      p.spokenText = `${p.p1} vor halb ${p.p3}`;
      return p;
    }

    // 35 -> five after half next
    if (m === 35){
      p.p1 = "f√ºnf";
      p.p2 = "nach halb";
      p.p3 = hourNumToWord(next);         // nach halb -> NEXT hour
      p.spokenText = `${p.p1} nach halb ${p.p3}`;
      return p;
    }

    // 40,45,50,55 -> before next
    if (m === 40 || m === 45 || m === 50 || m === 55){
      p.p1 = (m===40?"zwanzig":m===45?"viertel":m===50?"zehn":"f√ºnf");
      p.p2 = "vor";
      p.p3 = hourNumToWord(next);         // vor -> NEXT hour
      p.spokenText = `${p.p1} vor ${p.p3}`;
      return p;
    }

    // fallback: should not occur
    p.p1 = "";
    p.p2 = "punkt";
    p.p3 = hourNumToWord(hh);
    p.spokenText = `punkt ${p.p3} uhr`;
    return p;
  }

  // Parse dropdown selection to a time {h, m} in 12h clock (h 1..12)
  // This is the CRITICAL fixed part:
  // - "halb X" => (X-1):30
  // - "f√ºnf vor halb X" => (X-1):25
  // - "f√ºnf nach halb X" => (X-1):35
  // - "f√ºnf nach X" => X:05 etc.
  // - "f√ºnf vor X" => (X-1):55 etc.
  // - "punkt X" => X:00
  function partsToTime(p1, p2, p3){
    const H = wordToHourNum(p3);
    if (!H) return null;

    // normalize p1 empty
    const minutesWord = (p1 || "").trim();

    if (p2 === "punkt"){
      if (minutesWord !== "") return null;
      return {h: H, m: 0};
    }

    if (p2 === "halb"){
      if (minutesWord !== "") return null;
      // half to H => (H-1):30
      const base = (H === 1) ? 12 : (H - 1);
      return {h: base, m: 30};
    }

    if (p2 === "vor halb" || p2 === "nach halb"){
      if (!minutesWord) return null;
      if (minutesWord !== "f√ºnf") return null; // in deinem Dropdown gibt's hier nur "f√ºnf"
      const base = (H === 1) ? 12 : (H - 1);
      return {h: base, m: (p2 === "vor halb") ? 25 : 35};
    }

    if (p2 === "nach"){
      if (!minutesWord) return null;
      const map = {"f√ºnf":5,"zehn":10,"viertel":15,"zwanzig":20};
      if (!(minutesWord in map)) return null;
      return {h: H, m: map[minutesWord]};
    }

    if (p2 === "vor"){
      if (!minutesWord) return null;
      const map = {"f√ºnf":55,"zehn":50,"viertel":45,"zwanzig":40};
      if (!(minutesWord in map)) return null;
      // these are minutes before NEXT hour, so base hour is H-1
      const base = (H === 1) ? 12 : (H - 1);
      return {h: base, m: map[minutesWord]};
    }

    return null;
  }

  // -----------------------------
  // Dropdown fill
  // -----------------------------
  function fillDropdowns(){
    // p1
    p1Sel.innerHTML = "";
    MIN_WORDS.forEach(w=>{
      const opt = document.createElement("option");
      opt.value = w;
      opt.textContent = (w === "") ? "‚Äî" : w; // UI: dash, stored as ""
      p1Sel.appendChild(opt);
    });

    // p2
    p2Sel.innerHTML = "";
    FORM_WORDS.forEach(w=>{
      const opt = document.createElement("option");
      opt.value = w;
      opt.textContent = w;
      p2Sel.appendChild(opt);
    });

    // p3
    p3Sel.innerHTML = "";
    HOUR_WORDS.forEach(w=>{
      const opt = document.createElement("option");
      opt.value = w;
      opt.textContent = w;
      p3Sel.appendChild(opt);
    });

    // defaults
    p1Sel.value = "";
    p2Sel.value = "punkt";
    p3Sel.value = "eins";
  }

  function applyConstraintHints(){
    // Optional: leichte UI-Assistenz:
    // wenn form "punkt" oder "halb": minuten dropdown automatisch auf "‚Äî"
    const p2 = p2Sel.value;
    if (p2 === "punkt" || p2 === "halb"){
      p1Sel.value = "";
    } else if (p2 === "vor halb" || p2 === "nach halb"){
      if (p1Sel.value !== "f√ºnf") p1Sel.value = "f√ºnf";
    }
  }

  p2Sel.addEventListener("change", applyConstraintHints);

  // -----------------------------
  // Task generation
  // -----------------------------
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function randStep(min,max,step){
    const count = Math.floor((max-min)/step)+1;
    return min + randInt(0,count-1)*step;
  }

  function generateTime(){
    // both grades use 5-minute steps, but we can limit 2nd grade to easier times if desired
    // You asked: menu 3. klasse (minutenschritte) oder 2. klasse (volle 5 minuten-schritte)
    // -> beide sind 5er Schritte, aber 2. klasse: eher ohne 40/45/50/55? (sonst ist's oft zu schwer)
    // Ich mache:
    // - 2. klasse: {0,5,10,15,20,25,30,35} (bis nach halb) + gelegentlich 40/45 (selten)
    // - 3. klasse: alle 0..55 in 5er Schritten
    const hour = randInt(1,12);
    let minute;

    if (grade === "2"){
      const easier = [0,5,10,15,20,25,30,35];
      minute = easier[randInt(0, easier.length-1)];
    } else {
      minute = randStep(0,55,5);
    }
    return {h: hour, m: minute};
  }

  function makeKey(t){ return `${t.h}:${t.m}`; }

  function nextTask(){
    clearFeedback();
    let t, tries = 0;
    do{
      t = generateTime();
      tries++;
      if (tries > 500) break;
    } while (used.has(makeKey(t)));

    used.add(makeKey(t));
    current = t;

    drawClock(current.h, current.m);

    const parts = timeToParts(current.h, current.m);
    variantTag.textContent = (grade === "2") ? "2. klasse" : "3. klasse";
    progressEl.textContent = `aufgabe ${done+1} von ${TOTAL}`;

    // reset dropdowns to neutral
    p1Sel.value = "";
    p2Sel.value = "punkt";
    p3Sel.value = "eins";
    applyConstraintHints();

    // speak task
    speak(parts.spokenText);
  }

  function isSameTime(a,b){
    if (!a || !b) return false;
    return a.h === b.h && a.m === b.m;
  }

  function checkAnswer(){
    if (!current) return;

    const p1 = (p1Sel.value || "").trim();
    const p2 = (p2Sel.value || "").trim();
    const p3 = (p3Sel.value || "").trim();

    const guess = partsToTime(p1, p2, p3);
    const correctParts = timeToParts(current.h, current.m);

    if (!guess){
      wrong++;
      statBad.textContent = String(wrong);
      setFeedback("das passt nicht zusammen.", false);
      return;
    }

    if (isSameTime(guess, current)){
      correct++;
      statOk.textContent = String(correct);
      setFeedback("richtig! üëç", true);
    } else {
      wrong++;
      statBad.textContent = String(wrong);
      setFeedback(`leider falsch. korrekt w√§re: ${correctParts.spokenText}`, false);
    }

    done++;
    if (done >= TOTAL){
      end();
    } else {
      setTimeout(nextTask, 700);
    }
  }

  function end(){
    quizEl.classList.add("hidden");
    resultEl.classList.remove("hidden");

    const pct = Math.round((correct / TOTAL) * 100);
    summaryEl.innerHTML =
      `du hast <strong>${TOTAL}</strong> uhrzeiten gel√∂st.<br>`+
      `richtig: <strong>${correct}</strong> (${pct}%), fehler: <strong>${wrong}</strong>.`;
  }

  // -----------------------------
  // Start / navigation
  // -----------------------------
  gradeGrid.querySelectorAll(".grade").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const g = btn.dataset.grade;
      grade = (grade === g) ? null : g;

      gradeGrid.querySelectorAll(".grade").forEach(b=>{
        b.classList.toggle("selected", b.dataset.grade === grade);
      });

      if (!grade){
        startInfo.textContent = "bitte klasse ausw√§hlen.";
        startBtn.disabled = true;
      } else {
        startInfo.textContent = `ausgew√§hlt: ${grade}. klasse`;
        startBtn.disabled = false;
      }
    });
  });

  startBtn.addEventListener("click", ()=>{
    if (!grade) return;

    // reset state
    correct = 0; wrong = 0; done = 0;
    used = new Set();
    current = null;

    statOk.textContent = "0";
    statBad.textContent = "0";
    statTotal.textContent = String(TOTAL);

    startEl.classList.add("hidden");
    resultEl.classList.add("hidden");
    quizEl.classList.remove("hidden");

    fillDropdowns();
    applyConstraintHints();
    nextTask();
  });

  speakBtn.addEventListener("click", ()=>{
    if (!current) return;
    const parts = timeToParts(current.h, current.m);
    speak(parts.spokenText);
  });

  checkBtn.addEventListener("click", checkAnswer);

  againBtn.addEventListener("click", ()=>{
    resultEl.classList.add("hidden");
    startEl.classList.remove("hidden");
  });

  finishBtn.addEventListener("click", ()=>{
    finishBtn.disabled = true;
    finishBtn.textContent = "erledigt ‚úî";
    try{
      if (window.parent && window.parent !== window){
        window.parent.postMessage("AppSolved","*");
      }
    }catch(e){
      console.warn("learningview postmessage fehlgeschlagen:", e);
    }
  });

  // init
  (function init(){
    fillDropdowns();
    // neutral clock
    drawClock(12,0);
    startBtn.disabled = true;
    startInfo.textContent = "bitte klasse ausw√§hlen.";
    statTotal.textContent = String(TOTAL);
  })();
</script>
</body>
</html>
